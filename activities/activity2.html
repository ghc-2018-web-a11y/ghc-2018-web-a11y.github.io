<!DOCTYPE html>
<html lang="en">
    <head>
	    <link rel="stylesheet" href="activities.css">
    </head>
    <body>
	    <h1> Activity #2 </h1>

	    <h2>Tips</h2>
	    These tips will help you complete the exercises below.
	    <ul>
	    	<li>Open "main.js", "main.css", and "index.html" (or "index-no-embedded-screenreader.html" if you already have a screen reader installed on your machine that you'd prefer to use) side by side using a text editor of your choice.</li>
	    	<li>Open "index.html" (or "index-no-embedded-screenreader.html") in a web browser (we recommend using Chrome for best results).</li>
	    	<li>To make changes, modify the HTML, CSS, and Javscript files using a text editor, save the changes, and refresh the HTML page you opened in the web browser. The webpage should reflect the edits you made.</li>
	    	<li>Do not use inline CSS! This is not best practice, and may result in bugs on this website due to CSS precedence issues.</li>
	    	<li>Read the explanations for every exercise -- they're packed with information!</li>
	    	<li>If you get stuck, raise your hand for help, ask your neighbors, or (worst case) take a peak at the answer key located in the "solution" directory.</li>
	    </ul>

    	<h2>Exercises</h2>

	    <h3>Exercise 1: Headers</h3>
	    <p>
			Screen-reader-users rely on screen readers vocalizing what types of elements they are interacting with (e.g. "button" or "header"). Without these vocalizations, it's more difficult for users to make their way around a page and distinguish between different kinds of content.
	    <p>
	    </p>
			Real screenreaders have a variety of keyboard shortcuts used to navigate different kinds of elements on a page (e.g. 'b' might cycle through all buttons, or 'h' through all headers). The heading shortcut is very important for building a mental map of how the page is laid out, and help make the page faster to navigate as users can quickly skip to the content they are interested in. 
		</p>
		<p class="main-task">
		    Use the "heading" button at the bottom of the website to navigate all of the headers on the page. Notice that this allows you to navigate most of the headings on the site -- except for the site title (which reads "Online Garage Sale)! Take a look at the HTML for the headers that to see if you can figure out what's wrong with the site title and fix it.
	    </p>
		
		<button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden role="presentation">
			<p>
	            Text on a page must be identified as a header for a screen reader to recognize it. In the HTML file (index.html), you'll notice that most header text is wrapped in a header tag (h1, h2, h3, etc). If you wrap the site title in h1 tags, it will become navigable using the "heading" button.
			</p>
			<p>
				Main takeaway: Using proper HTML markup matters!
			</p>
	    </div>
		<h3>Exercise 2: Tabbing</h3>
		<p>
		    Screenreader and non-screenreader-users alike often use tab and shift+tab for navigating between interactive elements. It's important to always make sure that this functionality works correctly in addition to navigating by screenreader shortcuts.
		</p>
		<p class="main-task">
		    Try using the 'tab' key to navigate the demo page. You'll notice that the "Hand Painted Jar" cannot be focused. Compare the untabbable element to other elements on the page and see if you can figure out how to make it tabbable.
		</p>

		<button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>
				Some elements, such as buttons and form elements, are tabbable/focusable by default. If you want other HTML elements to be tabbable, (e.g. "div" or "span" which are more often text elements not interacted with by mouse or keyboard) you can give them a tabindex attribute.
			</p>
			<p>
				The tabindex HTML attribute defines the navigation order for focusable elements. In addition to giving non-focusable elements the ability to gain focus, it can be used to remove that ability from normally focusable elements.
			</p>
			<p>
				Possible values for the tabindex attribute are:
				<ul>
					<li>
						<div class="code inline">tabindex="1"</div><br />A positive value for the tabindex defines an explicit navigation order, and makes the element focusable if it is not already (not recommended, for reasons described below).
					</li>
					<li>
						<div class="code inline">tabindex="0"</div><br />A tabindex value of 0 does not change the natural navigation order of an element, but makes it focusable if it is not already.
					</li>
					<li>
						<div class="code inline">tabindex="-1"</div><br />A tabindex value of -1 makes an element unable to gain focus using the "tab" key. However, the element can still receive focus programatically, using javascript.
					</li>
				</ul>
			</p>
			<p>
				By default, the navigation order for elements on a page is left-to-right and top-to-bottom. A positive tabindex value allows the natural ordering to be modified. This is not recommended, especially for HTML pages with focusable elements (like buttons or input fields), since it results in unexpected jumps in focus. Imagine if hitting tab caused focus to jump from the start of the page to an element at the very bottom of the page (this is especially jarring for fully or partially-sighted users). Instead of manually changing the natural ordering, the actual HTML structure of the page should modified to produce the desired navigation order. 
			</p>
	    </div>
	

		<h3>Exercise 3: Broken Buttons</h3>
		<p>
			To buy an item on this page, a user must select the "BUY" button. Users who are using a mouse may select this button using their mouse. Users who are using the keyboard, however, must be able to interact this button by moving focus to it and using the "enter" key to select it.
		</p>
		<p class="main-task">
			Try using the tab key to navigate to the "BUY" buttons. You'll notice that these buttons cannot gain focus. Since the buttons can't gain focus, a user navigating with a screen reader or keyboard is unable to interact with it. If you hover over one of these buttons with the mouse, you'll also notice that the cursor doesn't change to the "default" cursor that is typical of buttons. Why do you think this might be (hint: take a look at the HTML)? Modify the HTML to see if you can fix the "BUY" buttons.
	    </p>
	    <button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>
				These buttons do not work as expected because they are actually "div" elements styled to look like buttons in CSS, not actual buttons. Try changing the buttons on this website from "div" elements to "button" elements. This includes the submitButton, dialogCloseButton, and all buyButton elements. 
			</p>
			<p>
				Test to see if this worked by using the "tab" key to navigate all buttons. Notice how the screen reader now vocalizes that they are buttons (e.g. "Buy, button")!
			</p>
		</div>

		<h3>Exercise 4: ARIA labels</h3>
		<p>
			Open the buy dialog and use tab to navigate to the "X" button. If you completed the last exercise, this button should now be navigable. Does the screen reader's vocalizattion of the button help determine what the button's purpose might be? You'll notice that the screen reader just describes the button as a "button button", which is not a helpful description.
		</p>
		<p class="main-task">
			An aria-label can be used to attach an alternative description to elements. This is particularly useful when the text inside an element is not sufficient to describe the element, as is commonly the case with icon buttons. Use this attribute to fix the vocalization of the "X" button inside the buy dialog.
		</p>
		<button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>
				Adding "aria-label='Close button'" to the "button" tag should fix the "X" button's vocalization.
			</p>
		</div>

        <h3>Exercise 5: ARIA roles</h3>
        <p>
        	Sometimes, for whatever reason, you can't use the correct native HTML elements. You may need to support legacy browsers that will have issues with the new HTML element, or there are other technical limitations. In these cases, you can use an ARIA role to still get the proper screenreader vocalizations. Let's try it out! 
        </p>
        <p class="main-task">
            Take the first button you modified in exercise 3 (the button corresponding to the elephant figurine), change it back to a div, and add <span class="code inline">aria-role="button"</span> as an attribute. How do you think this might be different from a native button element?
        </p>
        <button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>
				There are several problems with this button:
			</p>
			<ol> 
				<li>The button is not focusable (needs to be fixed with tabindex)</li>
				<li>The button does not have the default cursor (needs to be fixed with css)</li>
				<li>The button does not get clicked if the user uses the enter key (needs to be fixed by adding a javascript event handler)</li>
		    </ol>
		    <p>
				The aria-role does make sure that the screenreader vocalizes the div as a button, but, on its own, is not sufficient to make this element behave like a button.
		    </p>
		    <p>
			    Remember that aria labels may change what the screenreader vocalizes, or whether they are navigable using certain screenreader keyboard shortcuts, but they <em>do not affect browser functionality</em>. When you use a role instead of a native element, all the default browser behavior also needs to be replicated. Whenever possible, it's far better to just use a native element instead, which already has all the correct behavior by default. 
			</p>
	    </div>

		<h3>Exercise 6: Visibility</h3>
		<p>
		    You have probably noticed that there's an invisible dialog at the bottom of the screen that gets vocalized even though it's not showing. To reproduce this issue, try using tab to navigate though all the items on the page, and notice that there are a few items at the very end that are invisible to the eye, but navigable by screen reader. This is problematic, since non-sighted users will assume that the dialog is visible (and it may not function correctly since the developer did not intend for it to be interacted with in this state), and users with some vision will be confused when an element that they can hear is not visible on the screen.
	    </p>

		<p class="main-task">
	      Try hiding the dialog from screenreaders. There are several different solutions! Hint: Try taking a look at main.css.
	    </p>

		<button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>Here are three different solutions to solve this issue:</p>
			<ol>
			  <li>
			  	<p>
			  	  Hide completely with CSS: For some reason, the developers of this site used <span class="code inline">z-index:-1</span> to hide the dialog instead of just using <span class="code inline">display:none</span>. Both <span class="code inline">display:none</span> and <span class="code inline">visibility:hidden</span> will hide elements both visually and from screenreaders.
			    </p>
			    <p>
			  	  Lowering opacity to 0 using CSS, which will position the dialog off-screen, or adjusting z-index to hide it behind something else will NOT hide the dialog from screenreaders.
			    </p>
			    <p>
			    	IMPORTANT: If you used pure CSS to hide the dialog, make sure you modified the hidden class in main.css instead of adding an inline style, so that the dialog will not be hidden when you click the "Buy" button.
			    </p>
			  </li>
			  <li>
			  	Hidden attribute: The HTML <span class="code inline">hidden</span> attribute will similarly hide things both visually and from screenreaders. However, there are some limitations on its intended use; see the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/hidden">MDN documentation</a> for more details. Also, this attribute will need to be added and removed in Javascript when the dialog is shown or hidden.
			  </li>
			  <li>
			  	Hide from screenreaders with aria-hidden: If for some reason display:none or visibility:hidden cannot be used, the element can also be hidden by adding <span class="code inline">aria-hidden="true"</span> to the div. This attribute will need to be added and removed in Javascript when the dialog is shown or hidden.
			  </li>
		    </ol>
	    </div>
	
		<h3>Exercise 7: Dialogs</h3>
		<p>
			Using a screen reader, navigate to the "buy" dialog and tab through the various input fields inside the dialog. You'll notice a few issues with navigating the dialog using the screen reader, such as:
		
			<ol>
				<li>
				  There is no indication or announcement by the screen reader when the dialog opens.</li>
				<li>
				  Focus is mismanaged. Once the dialog opens, focus is still unexpectedly in the background of the page.
				</li>
			</ol>
		</p>
		<p class="main-task">
			Fix the dialog using a combination of HTML and JavaScript. This exercise is a little tricky, so feel free to click the button below for help and/or take a look at the solution directory!
		</p>
		
		<button onclick="hideNextNeighbor(this)" aria-expanded="false">Explanation</button>
		<div class="solution" hidden>
			<p>
				To fix this, the dialog must have correct labels and keyboard focus must be properly handled. Let's start by learning how to add proper labels to the dialog. First, a dialog must have the role="dialog" attribute. For sighted users, the dialog is identified by, or labelled by, its title. For screen readers to be able to associate the dialog with its title, we must use an aria-labelledby attribute, with a value corresponding to the id of the dialog's title element ("dialogTitle"). This attribute maps the dialog element to its title.

				When selecting the "BUY" button, you'll notice that focus remains in the background of the page. For the best user experience, focus should move to inside the dialog. The page's background should not be interactive using a keyboard. The steps below will fix this issue:
				<ol>
					<li>The dialog must be programatically focusable, using the tabindex="-1" attribute.</li>
					<li>When the dialog opens, we must programatically move focus to the dialog element using javascript. The "showDialog" function in main.js must be modified to achieve this.</li>
					<li>When the dialog closes, we must move focus back to the main page programatically using javascript. The "hideDialog" function in main.js must be modified to achieve this.</li>
					<li>To make sure that a user cannot use "tab" to navigate away from the dialog, we must capture focus inside the dialog. Using javascript, we can make sure that the tab key can't be use to move focus outside the dialog when it's visible.</li>
				</ol>

				Dialogs can be much more complex than the example on this page. To learn more about making dialogs compatible with screen readers, check out this <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques/Using_the_dialog_role">guide</a>.
		    </p>
		</div>
		
		<p>
			To learn more about accessibility with dialogs, visit https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques/Using_the_dialog_role.
		</p>

		<h3>Bonus Exercise 8: Advanced ARIA</h3>
		<p>
			ARIA comes in very handy when you're implementing a complex widget for which no native markup exists. For instance, if you're implementing a slider or an autocomplete, you need some way of concisely communicating to the user what the widget does and how to interact with it. 

			You'll notice that at the bottom of the "BUY" dialog is a tab widget. However, without aria roles and properties, screenreader users may not know how to interact with it. Using the ARIA spec, try adding the proper ARIA markup! Hint: You'll need to use javascript to update the markup when the tab selection changes.
		</p>

	    <h3>Bonus Exercise 9: Color contrast</h3>
		<p>
			Even though we've fixed the functionality of the buttons, they're still not quite fully accessible due to their low color contrast. The gray text (#808080) is difficult to discern from the blue (#0000FF) background. To learn more, check out the <a href="https://webaim.org/resources/contrastchecker/">WebAIM Contrast Checker</a>. Try different color combinations and modify the color or background-color attributes on the buttons to get a better color contrast ratio!
		</p>
		<blockquote>
			<p>
			  WCAG 2.0 level AA requires a contrast ratio of at least 4.5:1 for normal text and 3:1 for large text. Level AAA requires a contrast ratio of at least 7:1 for normal text and 4.5:1 for large text.
		    </p>
   			<p>
			  Large text is defined as 14 point (typically 18.66px) and bold or larger, or 18 point (typically 24px) or larger.
		    </p>
		    <p>
			   source: <a href="https://webaim.org/resources/contrastchecker/">https://webaim.org/resources/contrastchecker/</a>
		    </p>
		</blockquote>
		<p>
			Don't be afraid to push back on designs that use colors that have color contrast ratios that are too low!
		</p>

		<h2>Learn more</h2>
		<p>
		  If you'd like to learn more about how to create accessible web components, visit the <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques">MDN documentation on ARIA techniques</a>.
	    </p>

		<script>
          function hideNextNeighbor(button) {
          	const neighbor = button.nextElementSibling;
          	let isExpanded = button.getAttribute('aria-expanded') === 'true';
          	neighbor.hidden = isExpanded;
          	button.setAttribute('aria-expanded', !isExpanded);
          }
         </script>

	</body>
</html>